---
title: mysql学习3（事务）
published: 2025-10-27
description: mysql学习（事务）
image: "./cover.jpg"
tags: ["mysql"]
category: mysql
draft: false
---
### 概念

事务是一组操作的集合，它是一个不可分割的工作单位，事务会把所有的操作作为一个整体一起向系统提交或撤销操作请求，即这些**操作要么同时成功，要么同时失败**

### 操作方式

##### 方式一：隐式（推荐）

- 开启事务

  ```sql
  START TRANSACTION 或 BEGIN;
  ```

- 提交事务

  ```sql
  COMMIT;
  ```

  

- 回滚事务

  ```sql
  ROLLBACK;
  ```



##### 方式二：显式

- 查看事务提交方式

  ```sql
  SELECT @@AUTOCOMMOT;
  ```

- 设置事务提交方式，1为自动提交，0为手动提交，只对当前会话有效

  当 `AUTOCOMMIT` 为 `1` (开启) 时你执行的每一条 SQL 语句（如 `INSERT`, `UPDATE`, `DELETE`）都会被当作一个独立的事务（Transaction）并**立即自动提交**。

  关闭自动提交是进行**事务管理**的核心。它允许你将多个 SQL 语句组合成一个“原子”操作单元

  ```sql
  SET @@AUTOCOMMIT = 0;
  ```

- …(此处注册相关语句到事务中)

- 提交事务

  ```sql
  COMMIT;
  ```

- 回滚事务

  ```sql
  ROLLBACK;
  ```



### 事务四大特性

- 原子性(Atomicity) : 事务是不可分割的最小操作单元，要么全部成功，要么全部失败。
- 一致性(Consistency) : 事务完成时，必须使所有的数据保持一致性
- 隔离性(Isolation) : 数据库系统提供的隔离机制，保证事务在不受外部并发操作影响的独立环境下运行
- 持久性(Durability) : 事务一旦提交或回滚，它对数据库中的数据的改变就是永久的。



### 并发事务问题

| 问题       | 描述                                                         |
| ---------- | ------------------------------------------------------------ |
| 脏读       | 一个事务读到另外一个事务**还没有提交**的数据                 |
| 不可重复读 | 一个事务**先后读取**同一条记录，但是两次读取的数据不同，称之为不可重复读 |
| 幻读       | 一个事务按照**某个范围条件**查询数据，两次查询的结果**行数**不同 |



### 事务隔离级别

**读未提交 (Read Uncommitted)：**

- 啥也解决不了。允许脏读、不可重复读、幻读。

**读已提交 (Read Committed)：**

- **解决了：脏读。**
- 仍可能：不可重复读、幻读。
- (这是 Oracle, SQL Server 等数据库的默认级别)

**可重复读 (Repeatable Read)：**

- **解决了：脏读、不可重复读。**
- 仍可能：幻读（理论上）。
- (这是 MySQL (InnoDB) 的默认级别。但注意：MySQL 通过 Next-Key Locking 技术，在很大程度上也解决了幻读。)

**可串行化 (Serializable)：**

- **解决了：脏读、不可重复读、幻读。**
- 通过强制事务排队执行，完全避免了并发问题，但性能最差。